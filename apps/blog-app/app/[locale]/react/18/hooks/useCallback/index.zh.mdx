# useCallback

useCallback æ˜¯ä¸€ä¸ª React Hookï¼Œå¯è®©æ‚¨åœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´ç¼“å­˜å‡½æ•°å®šä¹‰ã€‚

``` javascript
useCallback(fn, dependencies);
```

## å‚æ•°

fn ï¼šè¦ç¼“å­˜çš„å‡½æ•°å€¼ã€‚å®ƒå¯ä»¥æ¥å—ä»»ä½•å‚æ•°å¹¶è¿”å›ä»»ä½•å€¼ã€‚React å°†åœ¨åˆå§‹æ¸²æŸ“æœŸé—´å°†å‡½æ•°è¿”å›ï¼ˆè€Œä¸æ˜¯è°ƒç”¨ï¼ï¼‰ç»™ä½ ã€‚åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼Œå¦‚æœè‡ªä¸Šæ¬¡æ¸²æŸ“ä»¥æ¥æ²¡æœ‰æ›´æ”¹ï¼Œ dependencies React å°†å†æ¬¡ä¸ºæ‚¨æä¾›ç›¸åŒçš„å‡½æ•°ã€‚å¦åˆ™ï¼Œå®ƒå°†ä¸ºæ‚¨æä¾›åœ¨å½“å‰æ¸²æŸ“æœŸé—´ä¼ é€’çš„å‡½æ•°ï¼Œå¹¶å°†å…¶å­˜å‚¨èµ·æ¥ï¼Œä»¥é˜²ä»¥åå¯ä»¥é‡å¤ä½¿ç”¨ã€‚React ä¸ä¼šè°ƒç”¨ä½ çš„å‡½æ•°ã€‚è¯¥å‡½æ•°å°†è¿”å›ç»™æ‚¨ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥å†³å®šä½•æ—¶ä»¥åŠæ˜¯å¦è°ƒç”¨å®ƒã€‚

dependencies ï¼š fn ä»£ç ä¸­å¼•ç”¨çš„æ‰€æœ‰ååº”å¼å€¼çš„åˆ—è¡¨ã€‚å“åº”å¼å€¼åŒ…æ‹¬ propsã€state ä»¥åŠç›´æ¥åœ¨ç»„ä»¶ä¸»ä½“ä¸­å£°æ˜çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°ã€‚å¦‚æœä½ çš„ linter æ˜¯ä¸º React é…ç½®çš„ï¼Œå®ƒå°†éªŒè¯æ¯ä¸ªååº”å€¼æ˜¯å¦éƒ½æ­£ç¡®æŒ‡å®šä¸ºä¾èµ–é¡¹ã€‚ä¾èµ–é¡¹åˆ—è¡¨å¿…é¡»å…·æœ‰æ’å®šæ•°é‡çš„é¡¹ï¼Œå¹¶ä»¥å†…è”æ–¹å¼ç¼–å†™ï¼Œå¦‚ [dep1, dep2, dep3] .React å°†ä½¿ç”¨ Object.is æ¯”è¾ƒç®—æ³•å°†æ¯ä¸ªä¾èµ–é¡¹ä¸å…¶å…ˆå‰çš„å€¼è¿›è¡Œæ¯”è¾ƒã€‚

## è¿”å›

åœ¨åˆå§‹æ¸²æŸ“æ—¶ï¼Œ useCallback è¿”å›å·²ä¼ é€’çš„ fn å‡½æ•°ã€‚

åœ¨åç»­æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œå®ƒå°†è¿”å›ä¸Šæ¬¡æ¸²æŸ“ä¸­å·²å­˜å‚¨ fn çš„å‡½æ•°ï¼ˆå¦‚æœä¾èµ–é¡¹æœªæ›´æ”¹ï¼‰ï¼Œæˆ–è¿”å›åœ¨æ­¤æ¸²æŸ“æœŸé—´ä¼ é€’çš„ fn å‡½æ•°ã€‚

## è­¦å‘Š

useCallback æ˜¯ä¸€ä¸ª Hookï¼Œå› æ­¤æ‚¨åªèƒ½åœ¨ç»„ä»¶çš„é¡¶å±‚è°ƒç”¨å®ƒæˆ–æ‚¨è‡ªå·±çš„ Hookã€‚ä¸èƒ½åœ¨å¾ªç¯æˆ–æ¡ä»¶ä¸­è°ƒç”¨å®ƒã€‚å¦‚æœéœ€è¦ï¼Œè¯·æå–ä¸€ä¸ªæ–°ç»„ä»¶å¹¶å°†çŠ¶æ€ç§»åŠ¨åˆ°å…¶ä¸­ã€‚

React ä¸ä¼šä¸¢å¼ƒç¼“å­˜çš„å‡½æ•°ï¼Œé™¤éæœ‰ç‰¹å®šçš„åŸå› ã€‚ä¾‹å¦‚ï¼Œåœ¨å¼€å‘ä¸­ï¼Œå½“æ‚¨ç¼–è¾‘ç»„ä»¶çš„æ–‡ä»¶æ—¶ï¼ŒReact ä¼šä¸¢å¼ƒç¼“å­˜ã€‚æ— è®ºæ˜¯åœ¨å¼€å‘ä¸­è¿˜æ˜¯åœ¨ç”Ÿäº§ä¸­ï¼Œå¦‚æœä½ çš„ç»„ä»¶åœ¨åˆå§‹æŒ‚è½½æœŸé—´æŒ‚èµ·ï¼ŒReact éƒ½ä¼šä¸¢å¼ƒç¼“å­˜ã€‚å°†æ¥ï¼ŒReact å¯èƒ½ä¼šæ·»åŠ æ›´å¤šåˆ©ç”¨ä¸¢å¼ƒç¼“å­˜çš„åŠŸèƒ½â€”â€”ä¾‹å¦‚ï¼Œå¦‚æœ React å°†æ¥æ·»åŠ å¯¹è™šæ‹ŸåŒ–åˆ—è¡¨çš„å†…ç½®æ”¯æŒï¼Œé‚£ä¹ˆä¸¢å¼ƒä»è™šæ‹ŸåŒ–è¡¨è§†å£æ»šåŠ¨å‡ºæ¥çš„é¡¹ç›®çš„ç¼“å­˜æ˜¯æœ‰æ„ä¹‰çš„ã€‚å¦‚æœæ‚¨ä¾èµ– useCallback æ€§èƒ½ä¼˜åŒ–ï¼Œè¿™åº”è¯¥ç¬¦åˆæ‚¨çš„æœŸæœ›ã€‚å¦åˆ™ï¼ŒçŠ¶æ€å˜é‡æˆ– ref å¯èƒ½æ›´åˆé€‚ã€‚

# ç”¨æ³•

## è·³è¿‡ç»„ä»¶çš„é‡æ–°æ¸²æŸ“

ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½æ—¶ï¼Œæœ‰æ—¶éœ€è¦ç¼“å­˜ä¼ é€’ç»™å­ç»„ä»¶çš„å‡½æ•°ã€‚è®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œçš„è¯­æ³•ï¼Œç„¶åçœ‹çœ‹å®ƒåœ¨å“ªäº›æƒ…å†µä¸‹æœ‰ç”¨ã€‚

è¦åœ¨ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ä¹‹é—´ç¼“å­˜å‡½æ•°ï¼Œè¯·å°†å…¶å®šä¹‰åŒ…è£…åˆ° Hook ä¸­ useCallback ï¼š

``` javascript
import { useCallback } from 'react';

function ProductPage({ productId, referrer, theme }) {
  const handleSubmit = useCallback((orderDetails) => {
    post('/product/' + productId + '/buy', {
      referrer,
      orderDetails,
    });
  }, [productId, referrer]);

  // ...
}
```

### è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥äº†è§£è¿™ä½•æ—¶æœ‰ç”¨

å‡è®¾æ‚¨æ­£åœ¨å°†ä¸€ä¸ª handleSubmit å‡½æ•°ä» ProductPage  ShippingForm ç»„ä»¶å‘ä¸‹ä¼ é€’ï¼š

``` jsx
function ProductPage({ productId, referrer, theme }) {
  // ...
  return (
    <div className={theme}>
      <ShippingForm onSubmit={handleSubmit} />
    </div>
  );
}
```

æ‚¨å·²ç»æ³¨æ„åˆ°ï¼Œåˆ‡æ¢ theme é“å…·ä¼šå†»ç»“åº”ç”¨ç¨‹åºç‰‡åˆ»ï¼Œä½†å¦‚æœæ‚¨ä» JSX ä¸­åˆ é™¤ ShippingForm ï¼Œå®ƒä¼šæ„Ÿè§‰å¾ˆå¿«ã€‚è¿™å‘Šè¯‰æ‚¨å€¼å¾—å°è¯•ä¼˜åŒ– ShippingForm ç»„ä»¶ã€‚


é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼ŒReact ä¼šä»¥é€’å½’æ–¹å¼é‡æ–°æ¸²æŸ“å…¶æ‰€æœ‰å­ç»„ä»¶ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“ä½¿ç”¨ä¸åŒçš„ theme é‡æ–°æ¸²æŸ“æ—¶ ProductPage ï¼Œ ShippingForm ç»„ä»¶ä¹Ÿä¼šé‡æ–°æ¸²æŸ“ã€‚è¿™å¯¹äºä¸éœ€è¦å¤ªå¤šè®¡ç®—å³å¯é‡æ–°æ¸²æŸ“çš„ç»„ä»¶æ¥è¯´å¾ˆå¥½ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨éªŒè¯äº†é‡æ–°æ¸²æŸ“çš„é€Ÿåº¦å¾ˆæ…¢ï¼Œ ShippingForm åˆ™å¯ä»¥åœ¨å…¶é“å…·ä¸ä¸Šæ¬¡æ¸²æŸ“æ—¶ç›¸åŒæ—¶è·³è¿‡é‡æ–°æ¸²æŸ“ï¼Œæ–¹æ³•æ˜¯å°†å…¶åŒ…è£…åœ¨ memo ï¼š

``` jsx
import { memo } from 'react';

const ShippingForm = memo(function ShippingForm({ onSubmit }) {
  // ...
});

```

é€šè¿‡æ­¤æ›´æ”¹ï¼Œ ShippingForm å¦‚æœå…¶æ‰€æœ‰é“å…·éƒ½ä¸ä¸Šæ¬¡æ¸²æŸ“æ—¶ç›¸åŒï¼Œåˆ™å°†è·³è¿‡é‡æ–°æ¸²æŸ“ã€‚è¿™æ—¶ç¼“å­˜å‡½æ•°å°±å˜å¾—å¾ˆé‡è¦äº†ï¼å‡è®¾æ‚¨å®šä¹‰ handleSubmit äº†æ²¡æœ‰ useCallback ï¼š

``` jsx
function ProductPage({ productId, referrer, theme }) {
  // Every time the theme changes, this will be a different function...
  function handleSubmit(orderDetails) {
    post('/product/' + productId + '/buy', {
      referrer,
      orderDetails,
    });
  }
  
  return (
    <div className={theme}>
      {/* ... so ShippingForm's props will never be the same, and it will re-render every time */}
      <ShippingForm onSubmit={handleSubmit} />
    </div>
  );
}
```

åœ¨ JavaScript ä¸­ï¼Œ function () {} or () => {} æ€»æ˜¯åˆ›å»ºä¸€ä¸ªä¸åŒçš„å‡½æ•°ï¼Œç±»ä¼¼äº {} å¯¹è±¡æ–‡æœ¬æ€»æ˜¯åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡çš„æ–¹å¼ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ä¼šæˆä¸ºé—®é¢˜ï¼Œä½†è¿™æ„å‘³ç€ ShippingForm é“å…·æ°¸è¿œä¸ä¼šç›¸åŒï¼Œæ‚¨çš„ memo ä¼˜åŒ–å°†ä¸èµ·ä½œç”¨ã€‚è¿™å°±æ˜¯æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ useCallback ï¼š

``` jsx
function ProductPage({ productId, referrer, theme }) {
  // Tell React to cache your function between re-renders...
  const handleSubmit = useCallback((orderDetails) => {
    post('/product/' + productId + '/buy', {
      referrer,
      orderDetails,
    });
  }, [productId, referrer]); // ...so as long as these dependencies don't change...

  return (
    <div className={theme}>
      {/* ...ShippingForm will receive the same props and can skip re-rendering */}
      <ShippingForm onSubmit={handleSubmit} />
    </div>
  );
}
```

é€šè¿‡ useCallback wrapping handleSubmit in ï¼Œå¯ä»¥ç¡®ä¿å®ƒåœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´æ˜¯ç›¸åŒçš„å‡½æ•°ï¼ˆç›´åˆ°ä¾èµ–é¡¹æ›´æ”¹ï¼‰ã€‚é™¤éå‡ºäºæŸç§ç‰¹å®šåŸå› ï¼Œå¦åˆ™ä¸å¿…å°†å‡½æ•°åŒ…è£…åœ¨å‡½æ•°ä¸­ useCallback ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼ŒåŸå› æ˜¯æ‚¨å°†å…¶ä¼ é€’ç»™åŒ…è£…åœ¨ memo ä¸­çš„ç»„ä»¶ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥è·³è¿‡é‡æ–°æ¸²æŸ“ã€‚æ‚¨å¯èƒ½éœ€è¦å…¶ä»–åŸå›  useCallback ï¼Œæœ¬é¡µå°†è¿›ä¸€æ­¥æè¿°è¿™äº›åŸå› ã€‚

### ä½ åº”è¯¥åœ¨ä»»ä½•åœ°æ–¹æ·»åŠ useCallbackå—?

å¦‚æœä½ çš„åº”ç”¨ä¸æ­¤ç½‘ç«™ç±»ä¼¼ï¼Œå¹¶ä¸”å¤§å¤šæ•°äº¤äº’éƒ½å¾ˆç²—ç³™ï¼ˆä¾‹å¦‚æ›¿æ¢é¡µé¢æˆ–æ•´ä¸ªéƒ¨åˆ†ï¼‰ï¼Œåˆ™é€šå¸¸ä¸éœ€è¦è®°å¿†ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ çš„åº”ç”¨æ›´åƒæ˜¯ä¸€ä¸ªç»˜å›¾ç¼–è¾‘å™¨ï¼Œå¹¶ä¸”å¤§å¤šæ•°äº¤äº’éƒ½æ˜¯ç»†ç²’åº¦çš„ï¼ˆå¦‚ç§»åŠ¨å½¢çŠ¶ï¼‰ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šå‘ç°è®°å¿†éå¸¸æœ‰å¸®åŠ©ã€‚

ç¼“å­˜å‡½æ•°ä»…åœ¨å°‘æ•°æƒ…å†µä¸‹ useCallback æœ‰ä»·å€¼ï¼š

- å°†å…¶ä½œä¸º prop ä¼ é€’ç»™åŒ…è£…åœ¨ memo ä¸­çš„ç»„ä»¶ã€‚å¦‚æœå€¼æœªæ›´æ”¹ï¼Œåˆ™è¦è·³è¿‡é‡æ–°å‘ˆç°ã€‚è®°å¿†åŠŸèƒ½ä»…å…è®¸ç»„ä»¶åœ¨ä¾èµ–é¡¹å‘ç”Ÿæ›´æ”¹æ—¶é‡æ–°æ¸²æŸ“ã€‚
- æ‚¨ä¼ é€’çš„å‡½æ•°ç¨åå°†ç”¨ä½œæŸäº› Hook çš„ä¾èµ–é¡¹ã€‚ä¾‹å¦‚ï¼ŒåŒ…è£…åœ¨ ä¸­ useCallback çš„å¦ä¸€ä¸ªå‡½æ•°ä¾èµ–äºå®ƒï¼Œæˆ–è€…ä½ ä¾èµ–äºè¿™ä¸ª useEffect. å‡½æ•°

åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå°†å‡½æ•°åŒ…è£…èµ·æ¥ useCallback æ²¡æœ‰ä»»ä½•å¥½å¤„ã€‚è¿™æ ·åšä¹Ÿæ²¡æœ‰å¤ªå¤§çš„å±å®³ï¼Œæ‰€ä»¥ä¸€äº›å›¢é˜Ÿé€‰æ‹©ä¸è€ƒè™‘ä¸ªåˆ«æƒ…å†µï¼Œå¹¶å°½å¯èƒ½å¤šåœ°è®°ä½ã€‚ç¼ºç‚¹æ˜¯ä»£ç çš„å¯è¯»æ€§é™ä½ã€‚æ­¤å¤–ï¼Œå¹¶éæ‰€æœ‰è®°å¿†éƒ½æ˜¯æœ‰æ•ˆçš„ï¼šä¸€ä¸ªâ€œå§‹ç»ˆæ˜¯æ–°çš„â€å€¼è¶³ä»¥ç ´åæ•´ä¸ªç»„ä»¶çš„è®°å¿†ã€‚

### åœ¨å®è·µä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ä¸ªåŸåˆ™ä½¿å¤§é‡è®°å¿†å˜å¾—ä¸å¿…è¦ï¼š

- å½“ä¸€ä¸ªç»„ä»¶ç›´è§‚åœ°åŒ…è£…å…¶ä»–ç»„ä»¶æ—¶ï¼Œè®©å®ƒæ¥å— JSX ä½œä¸ºå­ç»„ä»¶ã€‚ç„¶åï¼Œå¦‚æœåŒ…è£…ç»„ä»¶æ›´æ–°äº†è‡ªå·±çš„çŠ¶æ€ï¼ŒReact å°±çŸ¥é“å®ƒçš„å­ç»„ä»¶ä¸éœ€è¦é‡æ–°æ¸²æŸ“ã€‚
- æ›´å–œæ¬¢åœ°æ–¹çŠ¶æ€ï¼Œä¸è¦åœ¨å¿…è¦æ—¶è¿›ä¸€æ­¥æå‡çŠ¶æ€ã€‚ä¸è¦ä¿ç•™ç¬æ€çŠ¶æ€ï¼Œä¾‹å¦‚è¡¨å•ï¼Œä»¥åŠé¡¹ç›®æ˜¯æ‚¬åœåœ¨æ ‘çš„é¡¶éƒ¨è¿˜æ˜¯å…¨å±€çŠ¶æ€åº“ä¸­ã€‚
- ä¿æŒæ¸²æŸ“é€»è¾‘çš„çº¯ç²¹æ€§ã€‚å¦‚æœé‡æ–°æ¸²æŸ“ç»„ä»¶å¯¼è‡´é—®é¢˜æˆ–äº§ç”Ÿä¸€äº›æ˜æ˜¾çš„è§†è§‰ä¼ªå½±ï¼Œåˆ™è¿™æ˜¯ç»„ä»¶ä¸­çš„é”™è¯¯ï¼ä¿®å¤é”™è¯¯ï¼Œè€Œä¸æ˜¯æ·»åŠ è®°å¿†ã€‚
- é¿å…æ›´æ–°çŠ¶æ€çš„ä¸å¿…è¦çš„æ•ˆæœã€‚React åº”ç”¨ç¨‹åºä¸­çš„å¤§å¤šæ•°æ€§èƒ½é—®é¢˜éƒ½æ˜¯ç”±æºè‡ª Effects çš„æ›´æ–°é“¾å¼•èµ·çš„ï¼Œè¿™äº›æ›´æ–°é“¾ä¼šå¯¼è‡´ç»„ä»¶ä¸€éåˆä¸€éåœ°æ¸²æŸ“ã€‚
- å°è¯•ä»æ•ˆæœä¸­åˆ é™¤ä¸å¿…è¦çš„ä¾èµ–é¡¹ã€‚ä¾‹å¦‚ï¼Œä¸è®°å¿†ç›¸æ¯”ï¼Œå°†æŸäº›å¯¹è±¡æˆ–å‡½æ•°ç§»åŠ¨åˆ°æ•ˆæœå†…éƒ¨æˆ–ç»„ä»¶å¤–éƒ¨é€šå¸¸æ›´ç®€å•ã€‚

å¦‚æœç‰¹å®šçš„äº¤äº’ä»ç„¶æ„Ÿè§‰æ»åï¼Œè¯·ä½¿ç”¨ React å¼€å‘è€…å·¥å…·åˆ†æå™¨æŸ¥çœ‹å“ªäº›ç»„ä»¶ä»è®°å¿†ä¸­å—ç›Šæœ€å¤§ï¼Œå¹¶åœ¨éœ€è¦çš„åœ°æ–¹æ·»åŠ è®°å¿†ã€‚è¿™äº›åŸåˆ™ä½¿ç»„ä»¶æ›´æ˜“äºè°ƒè¯•å’Œç†è§£ï¼Œå› æ­¤åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½æœ€å¥½éµå¾ªå®ƒä»¬ã€‚ä»é•¿è¿œæ¥çœ‹ï¼Œæˆ‘ä»¬æ­£åœ¨ç ”ç©¶è‡ªåŠ¨è®°å¿†ï¼Œä»¥ä¸€åŠ³æ°¸é€¸åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

### ä»è®°å¿†å›è°ƒæ›´æ–°çŠ¶æ€

æœ‰æ—¶ï¼Œæ‚¨å¯èƒ½éœ€è¦æ ¹æ®è®°å¿†å›è°ƒä¸­çš„å…ˆå‰çŠ¶æ€æ›´æ–°çŠ¶æ€ã€‚

``` jsx
function TodoList() {
  const [todos, setTodos] = useState([]);

  const handleAddTodo = useCallback((text) => {
    const newTodo = { id: nextId++, text };
    setTodos([...todos, newTodo]);
  }, [todos]);
  // ...
}
```

é€šå¸¸å¸Œæœ›è®°å¿†å‡½æ•°å…·æœ‰å°½å¯èƒ½å°‘çš„ä¾èµ–é¡¹ã€‚å½“æ‚¨è¯»å–æŸä¸ªçŠ¶æ€åªæ˜¯ä¸ºäº†è®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€æ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä¼ é€’æ›´æ–°ç¨‹åºå‡½æ•°æ¥åˆ é™¤è¯¥ä¾èµ–é¡¹ï¼š

``` jsx
function TodoList() {
  const [todos, setTodos] = useState([]);

  const handleAddTodo = useCallback((text) => {
    const newTodo = { id: nextId++, text };
    setTodos(todos => [...todos, newTodo]);
  }, []); // âœ… No need for the todos dependency
  // ...
}
```

### é˜²æ­¢æ•ˆæœè§¦å‘è¿‡äºé¢‘ç¹

æœ‰æ—¶ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä» Effect å†…éƒ¨è°ƒç”¨å‡½æ•°ï¼š

``` jsx
function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  function createOptions() {
    return {
      serverUrl: 'https://localhost:1234',
      roomId: roomId
    };
  }

    useEffect(() => {
    const options = createOptions();
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, [createOptions]); // ğŸ”´ Problem: This dependency changes on every render
}
```

è¿™å°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ã€‚æ¯ä¸ªååº”å¼å€¼éƒ½å¿…é¡»å£°æ˜ä¸º Effect çš„ä¾èµ–é¡¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å£°æ˜ createOptions ä¸ºä¾èµ–é¡¹ï¼Œåˆ™ä¼šå¯¼è‡´æ‚¨çš„ Effect ä¸æ–­é‡æ–°è¿æ¥åˆ°èŠå¤©å®¤ï¼š

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥å°†éœ€è¦ä» Effect è°ƒç”¨çš„å‡½æ•°åŒ…è£…æˆ useCallback ï¼š

``` jsx
function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  const createOptions = useCallback(() => {
    return {
      serverUrl: 'https://localhost:1234',
      roomId: roomId
    };
  }, [roomId]); // âœ… Only changes when roomId changes

  useEffect(() => {
    const options = createOptions();
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, [createOptions]); // âœ… Only changes when createOptions changes
  // ...
}
```

``` jsx
function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  useEffect(() => {
    function createOptions() { // âœ… No need for useCallback or function dependencies!
      return {
        serverUrl: 'https://localhost:1234',
        roomId: roomId
      };
    }

    const options = createOptions();
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]); // âœ… Only changes when roomId changes
  // ...
}
```